<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#020617" />
    <title>Padel Community Hub</title>
    <link rel="manifest" href="manifest.json" />
    <script
      src="https://unpkg.com/@supabase/supabase-js@2.45.0/dist/umd/supabase.js"
      crossorigin="anonymous"
      defer
    ></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="src/styles/base.css" />
    <link rel="stylesheet" href="src/styles/components.css" />
    <link rel="stylesheet" href="src/styles/views.css" />
    <link rel="stylesheet" href="src/styles/responsive.css" />
  </head>
  <body>
    <div id="authGate" class="auth-gate" hidden>
      <div class="auth-panel">
        <div class="auth-panel__tabs" role="tablist">
          <button
            type="button"
            class="auth-tab is-active"
            data-auth-view-target="login"
            role="tab"
            aria-selected="true"
          >
            Anmelden
          </button>
          <button
            type="button"
            class="auth-tab"
            data-auth-view-target="register"
            role="tab"
            aria-selected="false"
          >
            Registrieren
          </button>
        </div>
        <div class="auth-card" data-view="login">
          <h2>Willkommen zur√ºck</h2>
          <p class="muted">
            Melde dich mit deiner E-Mail-Adresse an, um deine Padel-Sessions zu
            verwalten.
          </p>
          <form id="loginForm" class="auth-form" novalidate>
            <label>
              <span>E-Mail-Adresse</span>
              <input
                type="email"
                name="email"
                autocomplete="email"
                required
              />
            </label>
            <label>
              <span>Passwort</span>
              <input
                type="password"
                name="password"
                autocomplete="current-password"
                minlength="8"
                required
              />
            </label>
            <p class="form-error" role="alert" hidden></p>
            <button type="submit" class="primary auth-submit">Anmelden</button>
          </form>
        </div>
        <div class="auth-card" data-view="register" hidden>
          <h2>Neues Konto anlegen</h2>
          <p class="muted">
            Registriere dich mit deiner E-Mail-Adresse und w√§hle ein sicheres
            Passwort.
          </p>
          <form id="registerForm" class="auth-form" novalidate>
            <label>
              <span>Vor- &amp; Nachname</span>
              <input
                type="text"
                name="displayName"
                autocomplete="name"
                placeholder="z. B. Lea Schmidt"
                required
              />
            </label>
            <label>
              <span>E-Mail-Adresse</span>
              <input
                type="email"
                name="email"
                autocomplete="email"
                required
              />
            </label>
            <label>
              <span>Passwort</span>
              <input
                type="password"
                name="password"
                autocomplete="new-password"
                minlength="8"
                required
              />
            </label>
            <label>
              <span>Passwort best√§tigen</span>
              <input
                type="password"
                name="confirmPassword"
                autocomplete="new-password"
                minlength="8"
                required
              />
            </label>
            <p class="muted auth-hint">
              Das Passwort muss mindestens acht Zeichen lang sein und Buchstaben
              sowie Zahlen enthalten.
            </p>
            <p class="form-error" role="alert" hidden></p>
            <button type="submit" class="primary auth-submit">
              Konto erstellen
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="app-shell">
      <header class="mobile-header" id="mobileHeader">
        <div class="mobile-header__brand">
          <div class="mobile-header__icon">üéæ</div>
          <div>
            <p class="mobile-header__title">Padel Community</p>
            <p class="mobile-header__subtitle">Finde dein Match</p>
          </div>
        </div>
        <button
          type="button"
          class="mobile-header__toggle"
          id="mobileNavToggle"
          aria-controls="mobileNav"
          aria-expanded="false"
          aria-label="Navigation √∂ffnen"
        >
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </button>
      </header>
      <aside class="sidebar">
        <div class="brand">
          <div class="brand__icon">üéæ</div>
          <div>
            <h1>Padel Community</h1>
            <p>Finde dein n√§chstes Match!</p>
          </div>
        </div>
        <button
          type="button"
          class="sidebar__toggle"
          id="sidebarToggle"
          data-nav-toggle
          aria-controls="sidebarNav"
          aria-expanded="false"
          aria-label="Navigation umschalten"
        >
          <span class="sidebar__toggle-line" aria-hidden="true"></span>
          <span class="sidebar__toggle-line" aria-hidden="true"></span>
          <span class="sidebar__toggle-line" aria-hidden="true"></span>
        </button>
        <nav class="sidebar__nav" id="sidebarNav" aria-hidden="false">
          <div class="sidebar__nav-content">
            <div class="sidebar__nav-header">
              <p class="sidebar__nav-title">Navigation</p>
              <button
                type="button"
                class="sidebar__nav-close"
                data-nav-close
                aria-label="Navigation schlie√üen"
              >
                <span aria-hidden="true">√ó</span>
              </button>
            </div>
            <div class="sidebar__nav-list">
              <button class="nav-btn" data-target="dashboard">Community Dashboard</button>
              <button class="nav-btn" data-target="my-sessions">Meine Sessions</button>
              <button class="nav-btn active" data-target="my-appointments">
                Meine Termine
              </button>
              <button class="nav-btn" data-target="discover">Padel-Spots entdecken</button>
              <button class="nav-btn" data-target="settings">Einstellungen</button>
            </div>
          </div>
        </nav>
        <div class="sidebar__footer">
          <p class="muted">
            Tipp: Nutze Filter, um schnell die passenden Spiele nach Level und
            Ort zu finden.
          </p>
        </div>
      </aside>
      <main>
        <header class="topbar">
          <div class="topbar__intro">
            <h2 id="view-title">Meine Termine</h2>
            <p class="muted" id="view-description">
              Verwalte deine erstellten Matches, passe Details an und behalte
              alle Zusagen im Blick.
            </p>
            <div class="last-updated muted" id="lastUpdatedRow" hidden>
              <span id="lastUpdatedLabel">Zuletzt aktualisiert: ‚Äì</span>
              <button
                type="button"
                class="last-updated__action"
                data-action="refresh-dashboard"
                data-refresh-button
                aria-label="Aktualisieren"
              >
                <svg
                  class="refresh-icon"
                  data-refresh-icon
                  aria-hidden="true"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M21 12c0-4.971-4.029-9-9-9-3.636 0-6.78 2.167-8.192 5.278M3 4v4.5h4.5"
                    stroke="currentColor"
                    stroke-width="1.6"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M3 12c0 4.971 4.029 9 9 9 3.636 0 6.78-2.167 8.192-5.278M21 20v-4.5h-4.5"
                    stroke="currentColor"
                    stroke-width="1.6"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
                <span>Aktualisieren</span>
              </button>
            </div>
          </div>
          <div class="topbar__actions">
            <button
              type="button"
              class="topbar__refresh-btn"
              id="refreshDashboardButton"
              data-action="refresh-dashboard"
              data-refresh-button
              data-lock-during-refresh="true"
              aria-label="Aktualisieren"
            >
              <svg
                class="refresh-icon"
                data-refresh-icon
                aria-hidden="true"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M21 12c0-4.971-4.029-9-9-9-3.636 0-6.78 2.167-8.192 5.278M3 4v4.5h4.5"
                  stroke="currentColor"
                  stroke-width="1.6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M3 12c0 4.971 4.029 9 9 9 3.636 0 6.78-2.167 8.192-5.278M21 20v-4.5h-4.5"
                  stroke="currentColor"
                  stroke-width="1.6"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <div class="user-menu" id="userMenu" hidden>
              <div class="user-menu__avatar" id="userAvatar" aria-hidden="true">
                üë§
              </div>
              <div class="user-menu__details">
                <span id="userDisplayName"></span>
                <span id="userEmail" class="muted"></span>
              </div>
            </div>
          </div>
        </header>
        <div id="dataError" class="alert alert--warning global-error" role="alert" hidden></div>

        <div id="pushPermissionCard" class="push-permission dashboard-section" hidden>
          <div class="push-permission__content">
            <p class="push-permission__title">Push-Benachrichtigungen</p>
            <p id="pushPermissionDescription" class="muted">
              Wir pr√ºfen deine Einstellungen ‚Ä¶
            </p>
            <p class="push-permission__hint muted">
              Verwalte die Push-Einstellungen jederzeit √ºber das Men√º unter ‚ÄûEinstellungen‚Äú.
            </p>
          </div>
        </div>

        <section id="dashboard-view" class="view view--dashboard">
          <div class="stats-grid dashboard-section">
            <article class="stat-card">
              <h3>Aktive Matches</h3>
              <p class="stat-value" id="activeMatches">0</p>
              <p class="muted">Matches, denen du beitreten kannst</p>
            </article>
            <article class="stat-card">
              <h3>Verf√ºgbare Pl√§tze</h3>
              <p class="stat-value" id="openSpots">0</p>
              <p class="muted">Freie Pl√§tze √ºber alle Spiele</p>
            </article>
            <article class="stat-card">
              <h3>Community Tendenz</h3>
              <div class="trend-chip" id="communityTrend">+0</div>
              <p class="muted">Neue Zusagen in den letzten 24h</p>
            </article>
          </div>

          <section class="panel dashboard-section">
            <div class="panel__header">
              <h3>Bevorstehende Sessions</h3>
              <div class="filters">
                <select id="skillFilter">
                  <option value="all">Alle Levels</option>
                  <option value="Beginner">Beginner</option>
                  <option value="Intermediate">Intermediate</option>
                  <option value="Advanced">Advanced</option>
                </select>
                <select id="locationFilter">
                  <option value="all">Alle Orte</option>
                </select>
              </div>
            </div>
            <div id="eventsList" class="events-list"></div>
          </section>

          <section class="panel panel--history dashboard-section">
            <div class="panel__header">
              <h3>Vergangene Sessions</h3>
              <p class="muted">Letzte 14 Tage im √úberblick</p>
            </div>
            <div id="eventsHistory" class="events-history"></div>
          </section>

          <section class="panel calendar dashboard-section">
            <div class="panel__header">
              <h3>Kalender</h3>
              <div class="calendar__controls">
                <button id="prevWeek">‚óÄ</button>
                <div id="calendarRange"></div>
                <button id="nextWeek">‚ñ∂</button>
              </div>
            </div>
            <div id="calendarGrid" class="calendar__grid"></div>
          </section>
        </section>

        <section id="my-sessions-view" class="view">
          <section class="panel">
            <div class="panel__header">
              <h3>Deine zugesagten Sessions</h3>
              <p class="muted">
                Hier findest du alle Termine, denen du aktuell zugesagt hast.
              </p>
            </div>
            <div id="mySessionsList" class="events-list"></div>
          </section>
        </section>

        <section id="my-appointments-view" class="view view--split active">
          <section class="panel">
            <div class="panel__header">
              <h3>Meine Termine</h3>
              <p class="muted">
                √úbersicht √ºber deine erstellten Matches inklusive aktueller Zu-
                und Absagen.
              </p>
            </div>
            <div id="ownerAlerts" class="alert-stack"></div>
            <div id="myAppointmentsList" class="events-list"></div>
          </section>
          <form id="eventForm" class="panel form" data-mode="create">
            <div class="form__header">
              <h3>Neuen Termin erstellen</h3>
              <p class="muted">
                Teile deinen geplanten Slot mit der Community und lass andere
                beitreten.
              </p>
            </div>

            <div class="form__grid">
              <label>
                <span class="label-text"
                  >Titel <span class="required-marker" aria-hidden="true">*</span></span
                >
                <input type="text" name="title" placeholder="Morning Smash" required />
              </label>
              <label>
                <span class="label-text"
                  >Ort <span class="required-marker" aria-hidden="true">*</span></span
                >
                <select name="location" id="locationSelect" required></select>
              </label>
              <label class="full" id="customLocationWrapper" hidden>
                <span class="label-text"
                  >Eigener Ort
                  <span class="required-marker" aria-hidden="true">*</span></span
                >
                <input
                  type="text"
                  name="customLocation"
                  id="customLocationInput"
                  placeholder="z. B. Padelhalle Barmbek"
                />
              </label>
              <label>
                <span class="label-text"
                  >Datum <span class="required-marker" aria-hidden="true">*</span></span
                >
                <input type="date" name="date" required />
              </label>
              <label>
                <span class="label-text"
                  >Startzeit <span class="required-marker" aria-hidden="true">*</span></span
                >
                <select name="time" id="startTimeSelect" required>
                  <option value="">Startzeit w√§hlen</option>
                </select>
              </label>
              <label>
                <span class="label-text"
                  >Dauer (Stunden)
                  <span class="required-marker" aria-hidden="true">*</span></span
                >
                <input
                  type="number"
                  name="durationHours"
                  min="1"
                  max="6"
                  value="2"
                  required
                />
              </label>
              <label>
                <span class="label-text"
                  >Gesamtkosten (‚Ç¨)
                  <span class="required-marker" aria-hidden="true">*</span></span
                >
                <input type="number" name="totalCost" min="0" step="0.01" required />
              </label>
              <label>
                <span class="label-text"
                  >Ben√∂tigte Spieler
                  <span class="required-marker" aria-hidden="true">*</span></span
                >
                <input type="number" name="capacity" min="2" max="8" value="4" required />
              </label>
              <label>
                Skill Level
                <select name="skill">
                  <option value="Beginner">Beginner</option>
                  <option value="Intermediate" selected>Intermediate</option>
                  <option value="Advanced">Advanced</option>
                </select>
              </label>
              <label>
                PayPal-Link (optional)
                <input
                  type="url"
                  name="paypalLink"
                  placeholder="https://paypal.me/deinprofil"
                  pattern="https?://.*"
                />
              </label>
              <label class="full">
                <span class="label-text"
                  >Zusage Deadline
                  <span class="required-marker" aria-hidden="true">*</span></span
                >
                <div class="datetime-inputs deadline-field">
                  <div class="deadline-select-wrapper">
                    <select name="rsvpDeadlineOption" id="deadlineSelect" required>
                      <option value="">Zusage-Deadline w√§hlen</option>
                    </select>
                  </div>
                  <div class="deadline-custom" data-deadline-custom hidden>
                    <span class="deadline-custom__label">Individuelle Deadline</span>
                    <input
                      type="datetime-local"
                      id="customDeadlineInput"
                      data-deadline-custom-input
                      autocomplete="off"
                    />
                    <small class="deadline-custom__hint" data-deadline-helper>
                      W√§hle zuerst Datum und Startzeit, um eine Zusagefrist festzulegen.
                    </small>
                  </div>
                </div>
                <input type="datetime-local" name="rsvpDeadline" hidden />
              </label>
              <label class="full">
                Zus√§tzliche Infos
                <textarea
                  name="notes"
                  rows="3"
                  placeholder="Bringe eigene Schl√§ger mit, wir haben neue B√§lle vor Ort."
                ></textarea>
              </label>
            </div>

            <div class="form__actions">
              <button type="submit" class="primary">Termin speichern</button>
              <button
                type="button"
                class="button button--ghost"
                id="cancelEditButton"
                hidden
              >
                Abbrechen
              </button>
            </div>
          </form>
        </section>

        <section id="discover-view" class="view">
          <section class="panel places">
            <div class="form__header">
              <h3>Padel-Spots in deiner N√§he</h3>
              <p class="muted">
                Entdecke beliebte Locations und buche direkt √ºber den jeweiligen
                Anbieter.
              </p>
            </div>
            <div id="placesList" class="places__grid"></div>
          </section>
        </section>

        <!-- Einstellungen-Screen f√ºr Konto & Push -->
        <section id="settings-view" class="view settings-view">
          <section class="panel settings-panel">
            <div class="panel__header">
              <h3>Einstellungen</h3>
              <p class="muted">
                Passe Push-Benachrichtigungen und Kontoaktionen f√ºr deine Community an.
              </p>
            </div>

            <div class="settings-section" id="pushSettingsSection">
              <div class="settings-section__header">
                <div>
                  <p class="settings-section__eyebrow">Push-Benachrichtigungen</p>
                  <h4>Erhalte Benachrichtigungen zu neuen Events, Zusagen und Absagen.</h4>
                </div>
                <span class="settings-status" id="pushSettingsStatus" data-state="inactive"
                  >Deaktiviert</span
                >
              </div>
              <p class="muted settings-section__description">
                Aktiviere den Schalter, um sofort √ºber neue Events und Reaktionen informiert zu werden.
              </p>
              <div class="settings-toggle">
                <div class="settings-toggle__info">
                  <p class="settings-toggle__label">Benachrichtigungen</p>
                  <p class="muted settings-toggle__hint" id="pushSettingsHint">
                    Wir pr√ºfen deinen aktuellen Status ‚Ä¶
                  </p>
                </div>
                <!-- Push-Toggle wird in main.js gesteuert -->
                <label class="switch" id="pushSettingsToggleWrapper">
                  <input
                    type="checkbox"
                    class="switch__input"
                    id="pushSettingsToggle"
                    role="switch"
                    aria-checked="false"
                  />
                  <span class="switch__track" aria-hidden="true">
                    <span class="switch__thumb"></span>
                  </span>
                  <span class="switch__status" id="pushSettingsToggleLabel">Aus</span>
                </label>
              </div>
            </div>

            <div class="settings-section">
              <h4>Konto</h4>
              <p class="muted">
                Melde dich sicher ab, wenn du das Ger√§t wechselst oder eine Pause einlegst.
              </p>
              <button
                type="button"
                class="button button--danger settings-logout"
                data-action="logout"
              >
                Abmelden
              </button>
            </div>
          </section>
        </section>
      </main>
    </div>
    <nav class="mobile-nav-overlay" id="mobileNav" aria-hidden="true">
      <div class="mobile-nav-overlay__panel">
        <div class="mobile-nav-overlay__header">
          <div class="mobile-nav-overlay__brand">
            <div class="mobile-nav-overlay__icon">üéæ</div>
            <div>
              <p class="mobile-nav-overlay__title">Padel Community</p>
              <p class="mobile-nav-overlay__subtitle">Navigation</p>
            </div>
          </div>
          <button
            type="button"
            class="mobile-nav-overlay__close"
            id="mobileNavClose"
            aria-label="Navigation schlie√üen"
          >
            <span aria-hidden="true">√ó</span>
          </button>
        </div>
        <div class="mobile-nav-overlay__links">
          <button class="nav-btn" data-target="dashboard">Community Dashboard</button>
          <button class="nav-btn" data-target="my-sessions">Meine Sessions</button>
          <button class="nav-btn active" data-target="my-appointments">Meine Termine</button>
          <button class="nav-btn" data-target="discover">Padel-Spots entdecken</button>
          <button class="nav-btn" data-target="settings">Einstellungen</button>
        </div>
      </div>
    </nav>
    <div
      class="sidebar__overlay"
      id="sidebarOverlay"
      hidden
      aria-hidden="true"
    ></div>
    <script src="src/main.js" type="module"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          const swUrl = new URL('./service-worker.js', window.location.href);
          navigator.serviceWorker
            .register(swUrl.href)
            .catch((err) => console.error('Service Worker registration failed', err));
        });
      }
    </script>
  </body>
</html>
